@model MusicStoreInfo.Domain.Entities.Product

@{
    ViewData["Title"] = "Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<head>
    <meta charset="utf-8" />
    <title>Продукты(подробнее)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>

<h1>Подробнее</h1>

<div>
    <h4>Продукт</h4>
    <hr />
    <dl class="row">
        <dt class = "col-sm-2">
            Магазин
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Store.Name)
        </dd>
        <dt class = "col-sm-2">
            Альбом
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Album.Name)
        </dd>
        <dt class="col-sm-2">
        </dt>
        <dd class="col-sm-10">
            <img src="@("~/image/" + Model.Album.ImagePath)" asp-append-version="true" width="200px" height="200px" />
        </dd>
        <dt class="col-sm-2">
            Группа
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Album.Group.Name)
        </dd>
        <dt class = "col-sm-2">
            Дата поставки
        </dt>
        <dd class = "col-sm-10">
            @Model.DateReceived.ToString("dd.MM.yyyy")
        </dd>
        <dt class = "col-sm-2">
            Количество
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Quantity)
        </dd>
        <dt class = "col-sm-2">
            Цена
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Price)
        </dd>
    </dl>
</div>

<h2>Песни альбома</h2>
<table class="table table-bordered">
    <tr>
        <th>
            Id
        </th>
        <th>
            Название
        </th>
        <th>
            Длительность
        </th>
        <th>
            Альбом
        </th>
    </tr>
    @foreach (var item in Model.Album.Songs)
    {
        <tr>
            <td>
                @item.Id
            </td>
            <td>
                @item.Name
            </td>
            <td>
                @item.Duration
            </td>
            <td>
                @item.Album.Name
            </td>
        </tr>
    }
</table>

<div>
    @if (User.IsInRole("Manager"))
    {
        <a asp-action="Edit" class="btn btn-primary" asp-route-id="@Model?.Id">Изменить</a>
    }
    <a asp-action="Index" class="btn btn-secondary">Вернуться назад</a>
</div>


<h2>Комментарии и отзывы</h2>
<div>
    @if (User.Identity.IsAuthenticated)
    {
        <form asp-controller="Review" asp-action="AddReview" method="post">
            <input type="hidden" name="UserName" value="@User.Identity.Name" />
            <input type="hidden" name="ProductId" value="@Model.Id" />
            <input type="hidden" name="StoreId" value="@Model.StoreId" />
            <input type="hidden" name="AlbumId" value="@Model.AlbumId" />
            <input type="hidden" name="TimeCreated" value="@DateTime.Now.ToString("yyyy-MM-ddTHH:mm:ss")" />
            <div class="form-group">
                <label for="rating">Рейтинг:</label>
                <div id="rating" class="rating">
                    @for (int i = 1; i <= 5; i++)
                    {
                        <input type="radio" id="star-@i" name="Rating" value="@i" />
                        <label for="star-@i" title="@i звезда">@i звезда</label>
                    }
                </div>
            </div>
            <div class="form-group">
                <label for="commentText">Ваш комментарий:</label>
                <textarea class="form-control" id="commentText" name="Comment" rows="3" required></textarea>
            </div>
            <button type="submit" class="btn btn-primary mt-2">Отправить</button>
        </form>
    }
    else
    {
        <p>Пожалуйста, <a asp-controller="Account" asp-action="Login">войдите</a>, чтобы оставить комментарий.</p>
    }
</div>

<h3>Отзывы</h3>
<div id="comments-section">
    @foreach (var review in Model.Reviews)
    {
        <div class="comment mb-3">
            <div class="comment-header">
                <strong>@review.User.UserName</strong> <span class="text-muted">@review.TimeCreated.ToString("dd.MM.yyyy HH:mm")</span>
                <div class="rating">
                    @for (int i = 1; i <= 5; i++)
                    {
                        if (i <= review.Rating)
                        {
                            <i class="fas fa-star" style="color: gold;"></i>
                        }
                        else
                        {
                            <i class="far fa-star" style="color: gold;"></i>
                        }
                    }
                </div>
            </div>
            <div class="comment-body">
                @review.Comment
            </div>
        </div>
    }
</div>